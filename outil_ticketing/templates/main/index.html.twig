{% extends 'base.html.twig' %}

{% block title %}Gestionnaire de tickets
{% endblock %}

{% block body %}
	{% include "_partials/_header.html.twig" %}
	<section class="row m-0">
		{% include "_partials/_sidebar.html.twig" %}

		<div class="col-md-10 m-0" id="dashboard">
			<h1>Tableau de bord</h1>

			<!--RANKINGS OF TICKETS AND BEST TECHNICIEN-->
			<div class="ranking">
				<div class="openedTickets">
					<div class="rank">{{ openedTicketsCount }}</div>Tickets en cours</div>
				<div class="closedTickets">
					<div class="rank">{{ closedTicketsCount }}</div>Tickets résolus</div>
				<div class="bestTech">
					<div class="rank">
						{% if bestTechnician %}
							{{ bestTechnician.firstName }} {{ bestTechnician.lastName }}{% else %}Aucun technicien trouvé
						{% endif %}
					</div>
					Best tech !
				</div>
			</div>

			<!--DASHBOARD OF OPENED TICKETS-->

			<table>
				<thead>
					<tr>
						<th>Ticket</th>
						<th>Auteur</th>
						<th>Statut</th>
						<th>Titre</th>
						<th>Créé le</th>
						<th>Modifier</th>
						<th>Afficher</th>
						<th>Répondre</th>
					</tr>
				</thead>
				<tbody>
					{% for ticket in tickets %}
						<!--DISPLAY ONLY OPENED TICKETS-->
						{% if ticket.status == 'ouvert' %}
							<tr>
								<td>{{ ticket.id }}</td>
								<!--GETTING USER WHO HAS CREATED THE TICKET-->
								<td>{{ ticket.user.firstName }}
									{{ ticket.user.lastName }}</td>
								<td>{{ ticket.status }}</td>
								<td>{{ ticket.title }}</td>
								<td>{{ ticket.createdAt ? ticket.createdAt|date('d-m-Y à H:i') : '' }}</td>
								<td>
									{% if is_granted('ROLE_ADMIN') or ticket.user == app.user %}
										<a href="{{ path('app_tickets_edit', {'id': ticket.id}) }}">
											<i class="fa-solid fa-pencil"></i>
										</a>
									{% endif %}
								</td>
								<td>
									<a href="{{ path('app_tickets_show', {'id': ticket.id}) }}">
										<i class="fa-solid fa-magnifying-glass-plus"></i>
									</a>
								</td>
								<td>
									<a href="{{ path('app_answers_new', {'id': ticket.id}) }}">
										<i class="fa-regular fa-comment-dots"></i>
									</a>
								</td>
							</tr>
						{% endif %}
					{% endfor %}
				</tbody>
			</table>

		</div>
	</section>
	{% include "_partials/_footer.html.twig" %}
{% endblock %}
